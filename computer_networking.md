
# **计算机网络基础**

## **第1章 计算机网络的基础知识**

### **1.1 计算机网络的定义**
计算机网络是指具有**独立功能的计算机或其他设备**，用一定**通信设备**和**介质互相连接**起来，能够实现**信息传递和资源共享**的系统  
**关键词**：设备，互联，信息传递和资源共享

### **1.2 计算机网络的组成**
**计算机设备**，**传输介质**，**网络协议实体**。其中传输介质也可以认为是网络协议实体的一部分。因此计算机网络的概念也可以简单的定义为：**自主计算机**的**互联**集合。

**网络协议实体**：用传输介质连接起来的计算机之间要实现通信，必须遵循共同的约定和通信规则，这些约定和规则叫**协议**。

### **1.3 计算机网络的分类**  
常见分类方法：按通信技术分类、按分布距离分类

#### 1.3.1 广播式网络和点到点网络
* 广播式网络：网上的任何一台计算机都可以发送广播分组（目的地址是广播地址），并且其他所有的计算机都要接受和处理这类分组。 **局域网是广播式网络**。 
* 点到点网络：类比于电话。每条物理线路只连接一对计算机，采用**存储转发和路由选择**。**信息在因特网上的转发是点到点网络**。

#### 1.3.2 局域网、广域网和城域网

* 局域网（LAN）：范围小，传输速率高，延迟小。主要采用**广播式通信技术**。局域网搭建主要采用**以太网、令牌环网、FDDI、无线局域网**。
* 广域网(WAN)：范围大，采用**点到点通信技术**（路由选择）。典型的广域网技术有**X.25和帧中继**。
* 城域网(MAN): **IEEE 802.6**

互联网：将各个网络连起来就是互联网，最大的互联网是Internet。

### **1.4 计算机网络的拓扑结构**
![拓扑结构](http://sytvu.ln.cninfo.net/jsjwh/ch07/pt01/Image/jw070103_tuopu.GIF)
#### 1.4.1 总线型拓扑结构
用一根线作为公共信道，所有节点连接到总线上，通过总线进行传输。应用的典型代表：**同轴电缆以太网**。总线拓扑使用**广播式通信技术**，共享式网络的代表。同一时刻只能有一台计算机向信道发送数据，因此整体性能随网络上节点的增多而急剧下降。

缺点：总线上的任何一个节点和链路出现问题会导致网络瘫痪，且故障检测比较困难。

#### 1.4.2 环形拓扑结构
* 单环结构：数据沿一个方向，环上将数据放大，直到数据到达目标节点。典型代表：**令牌环**。
* 双环结构：数据能在两个方向上传输，如果一个方向断了还可以沿另一个方向传输。典型代表：**FDDI**。

这两种也是共享信道网络，和总线型类似，网上只能有一个节点发送数据，因此节点数增加时整体性能会下降。目前已经淘汰。

#### 1.4.3 星型拓扑结构
各个节点通信要通过中心节点。主要用在局域网上，典型代表是**双绞线以太网**。星型结构有的采用广播式通信技术，有的是点到点通信有共享信道也有非共享。

星型网络任何一个节点发送数据都必须进过中心，中心节点失效网络就会瘫痪。

#### 1.4.4 网状型（分布型）拓扑结构
节点之间连接是任意的，没有规律，但是结构复杂，必须采用路由选择算法和流量控制方法。**WAN和Internet**基本上采用的都是网状型结构。

#### 1.4.5 树形拓扑结构
物理上基本不用。

### **1.5 计算机网络的体系结构**
#### 1.5.1 网络协议分层模型
![网络分层协议模型](https://blog.yarnoma.com/wp-content/uploads/2018/12/D85809AADDAF0F200DED3B6A438FC293.jpg)
协议分层将完整的通信过程分成若干个较小的问题，从而分为若干个协议层层，每一层次的内容都可以独立地解决，每一层内部协议的修改不影响其它层级的运行。

理论上，通信过程中报文由发送端的协议栈最顶层传到最底层，然后通过网络将报文发到接收端的最底层，然后接收端的协议栈将报文传到最上一层直到被接收程序接收。不同机器上的相同协议层成为对等层，同一台机器上每一对相邻层之间都有接口，用来在上下层之间交换数据。

发送端向下传递数据时增加的信息叫做报头（Header），也叫首部。将上层传来的数据加上本层报头后构成本层分组数据的操作叫**封装**，相应的，接收端将分组的数据区部分提取出来交给上一层的操作叫**解封**。
![封装和解封](https://blog.yarnoma.com/wp-content/uploads/2018/12/293E7F9C721149CACB09804864CE07D9.jpg)

#### 1.5.2 网络服务
##### 1.网络服务的概念
在网络协议的作用下，两个同等层实体之间的通信使得本层能够向它相邻的上一层提供支持，以便上一层完成自己的功能，这种支持叫做**服务**。

**网络服务**是指彼此相邻的两层间下层为上层提供通信能力或操作而屏蔽其细节的过程。

可见协议是水平的，服务是垂直的。

##### 2.面向连接的服务
**连接**是指对等层的两个实体之间为传输数据建立的逻辑通道，利用连接进行数据传输而向上层提供服务的方式就是面向连接的服务。也就是说服务过程中数据即时通信（类比电话），具有较高的可靠性。

##### 3.无连接的服务
每个分组独立传送到目的地，不需要建立连接。双方不需要都处于工作状态，适用于传送数据量小的情况，方便灵活。

#### 1.5.3 ISO/OSI参考模型
ISO/OSI标准将计算机网络的层级结构划为七层：
**物理层、数据链路层、网络层、传输层、会话层、表示层、应用层**。

前两层为低层，其他为高层。低层对应的就是局域网、城域网、广域网协议标准，高层对应的是TCP/IP协议族等。底层协议由以太网、令牌环、FDDI等硬件和软件实现，高层协议由软件实现，如TCP/IP。

#### 1.5.4 IEEE 802 标准
对于OSI模型的低层，在局域网和城域网上广泛使用的是IEEE 802 系列标准：

IEEE 802.1：高层局域网协议（Bridging (networking) and Network Management）  
IEEE 802.2：逻辑链路控制（Logical link control）  
**IEEE 802.3：以太网（Ethernet）**  
IEEE 802.4：令牌总线（Token bus）  
IEEE 802.5：令牌环（Token-Ring）  
IEEE 802.6：城域网（MAN, Metropolitan Area Network）  
IEEE 802.7：宽带TAG（Broadband LAN using Coaxial Cable）  
IEEE 802.8：光纤分布式数据接口（FDDI）  
IEEE 802.9：综合业务局域网（Integrated Services LAN）  
IEEE 802.10：局域网网络安全（Interoperable LAN Security）  
**IEEE 802.11：无线局域网（Wireless LAN & Mesh）**  
IEEE 802.12：需求优先级（Demand priority）  
IEEE 802.13：（未使用）  
IEEE 802.14：电缆调制解调器（Cable modems）  
IEEE 802.15：无线个人网（Wireless PAN）  
IEEE 802.15.1：无线个人网络（WPAN, Wireless Personal Area Network）  
IEEE 802.15.4：低速无线个人网络（LR-WPAN, Low Rate Wireless Personal Area Network）  
IEEE 802.16：宽带无线接入（Broadband Wireless Access）  
IEEE 802.17：弹性数据包环传输技术（Resilient packet ring）  
IEEE 802.18：无线电管制技术（Radio Regulatory TAG）  
IEEE 802.19：共存标签（Coexistence TAG）  
IEEE 802.20：移动宽带无线接入（Mobile Broadband Wireless Access）  
IEEE 802.21：介质独立换手（Media Independent Handover）  
IEEE 802.22：无线区域网（Wireless Regional Area Network）  
IEEE 802.23：紧急服务工作组（Emergency Services Working Group），2010年3月新发布 

#### 1.5.5 TCP/IP 协议族
TCP/IP是专门针对互联网络开发的一种体系结构和协议标准，目的是在于解决异种计算机通信的问题，使得网络在互联时把底层细节隐藏起来，为用户提供一种通用、一致的通信服务。

分为：**应用层、传输层、互联网层、网络接口层**

#### 1.5.6 总结
ISO/OSI协议庞大而复杂，导致未实用，但对计算机网络的发展起到了很好的指导作用；IEEE 802系列标准定义了局域网和城域网的技术标准，但只定义了物理层和数据链路层；目前TCP/IP协议族用于计算机网络的高层协议。

## 第2章 低层网络技术

### **2.1 数据通信的基础知识**
* **数据**：表达信息的实体；  
**信号**：数据的电、磁、光的表现形式用以传输数据（模拟信号、数字信号）；  
**信道**：传输信号的通道。
* **信号的带宽：** 一个信号所包含谐波的频率范围
* **信道的带宽：** 频率0到$f_c$的范围内谐波在信道传输中无衰减，则$f_c$称为截止频率，$0 \sim f_c$称为信道的带宽
* 有噪声信道上，信道的极限传输速率受**信道的带宽**和**信道的信噪比**限制
* **单工通信**：只能有一个方向的通信，有线电视系统是电性的单工通信。
* **半双工通信**：通信的双方都可以发送信息，也可以接受信息，但是不能在同一时间发送，只能一方发送一方接收。
* **全双工通信**：通信的双方可以同时发送和接收信息，需要两条独立的信道。

### **2.2 传输介质**
#### **2.2.1 双绞线**
把两根有绝缘保护层的铜导线互相绞合而成，可降低信号干扰的程度。通常把一对或多对（2对或4对）双绞线套在一个绝缘套管中构成双绞线电缆（**就是常见的网线**）。
* 屏蔽双绞线和非屏蔽双绞线
* 双绞线的规格：1类线到6类线，从2类线到6类线的数据传输速率分别为4Mbps，10Mbps，20Mbps，100Mbps，1Gbps。

#### 2.2.2 同轴电缆
共有四层，从内到外分别是中心导体、绝缘层、导体网和保护套。比双绞线有更好的屏蔽性能和传输距离，但价格更贵。

##### 1. 基带同轴电缆和宽带同轴电缆
* 基带同轴电缆：传输数字信号，传输过程中信号占用整个信道，数字信号包括由0到该基带同轴电缆所能传输的最高频率。因此，同一时间只能传送一种信号。
* 宽带同轴电缆:传送不同频率的信号，通过调制技术调制到各自不同的正弦波载波频率上。也可以用于一条信道的传输，性能比基带同轴电缆好，但需要调制，安装困难主要用于有线电视。

* 计算机网络中主要使用基带同轴电缆。

##### 2. 粗缆和细缆
粗缆的传输距离远，但安装难度大，总体成本高，没有细缆应用广泛。

细缆安装简单，通过T形头连到网卡上，形成总线型网络。

#### 2.2.3 光纤
##### 1. 光纤的结构及原理
光纤由纤芯、包层、护套层组成。纤芯是石英玻璃拉成的细丝，包层是折射率低的玻璃，使光保持在芯内。由多条光纤扎在一起用外壳包裹起来成为光缆。光纤的原理：光在光纤内发生全反射传递。

光纤发送端光源采用LED或半导体激光。
##### 2.单模光纤和多模光纤
多模光纤：多种入射角度不同的光纤在一条光纤中传输，每束光线认为是一个
不同的模式，这种光纤直径较粗。容易失真，只适合近距离传输。

单模光纤：光纤直径很细，使得光线沿直线传播，造价昂贵但可以传输更远的距离。
##### 3. 光纤的连接
光纤连接器、机械连接、熔接。

#### 2.2.4 无线传输
计算机网络主要使用微波通信（地面微波通信和卫星通信）。

### **2.3 以太网**
按传输技术以太网分为：
* 共享式以太网
* 交换式以太网

按最大传输速率分为：
* 10M以太网
* 快速以太网（100Mbps）
* 千兆以太网（1Gbps）
* 万兆以太网（10Gbps）

通常，早期的10M共享式以太网被称为传统以太网。

#### 2.3.1 传统以太网
##### 1. 两个标准：DIX Ethernet V2和IEEE 802.3
##### 2. 传统以太网的传输介质
可用：粗同轴电缆（10BASE5）、细同轴电缆(10BASE2)、双绞线(10BASE-T)、光纤(10BASE-F)。其中10表示速率为10Mbps，BASE表示基带信号，“5”表示粗缆，"2"表示细缆，T表示双绞线，F表示光纤。
##### 3. 传统以太网的介质访问控制
解决的是总线型网络一个公共信道的分配问题，采用CSMA/CD协议。
* CSMA：侦听信道上有无其他节点发送数据，若信道忙就等待，直到空闲。侦听时如果检测到信号忙：
  * **坚持型**：持续监听，直到空闲
  * **非坚持型**：延迟一个随机事件，然后再次侦听，不断重复此过程，直到空闲
  
  目前一般使用**非坚持型**。

* CD：发送数据的同时进行冲突检测，一旦发现冲突立即停止发送，等待冲突平息后再次执行CSMA/CD协议，直到发送成功。  
  * **产生冲突的原因**：空闲时一个节点A先发出信号，由于存在延迟另一个节点B在A发出信号但并未传输到B时发送信号，两个信号产生冲突；空闲时多个节点同时发送数据。  
  * **解决方法**：发现冲突后，立即停止发送数据，然后延迟一断时间再去抢占信道，延迟的时间由随机数决定，这样确保有一个节点先抢占到信道，然后其他节点进入等待监听状态，如果还存在冲突（可能还是出现延时冲突），则重复执行CD过程，直到有一个节点抢占信道。这种延迟竞争法成为”**冲突控制算法**“或“**延迟退避算法**”。

#### 2.3.2 交换式以太网
核心设备：**以太网交换机**，有两种类型：第二层交换机和第三层交换机，一般情况下交换机是指**第二层交换机**。
##### 1.交换机的结构与工作原理
* 交换机与集线器的不同：交换机可在内部多个端口建立多个并发连接，集线器只能在一堆端口建立连接。  
* 由于交换机是在多端口网桥的基础上发展起来，实现物理层和数据链路层协议，因此被称为”第二层“交换机。
* 典型的以太网交换机使用了**存储转发机制**。内部有一张转发表，记录者局域网上站点的MAC地址和所连接的端口号。当交换机收到一个MAC帧后，首先缓存在缓冲区内，检查无错后，交换机检查转发表中是否有源地址，若有则忽略，若无则添加进转发表。其次根据其目的MAC地址查找转发表，若存在匹配项则从端口转发出去，若没有则向所有端口转发。![转发表](https://blog.yarnoma.com/wp-content/uploads/2018/12/图2.15交换机的结构及转发表的内容_1.jpg)因此转发表设置了一种自我学习的机制。而交换机使用超时机制使转发表适应网络上站点的变化，即在记录MAC地址和转发端口时同时登记进入的时间，一定时间后清除缓存，周期性管理转发表中的项目。

##### 2.交换式局域网的特点
* 独占端口带宽，且网络总带宽随端口数增加而增加。而且对于全双工交换式网络，不仅端口之间没有冲突，同一端口也没有冲突，不需要CSMA/CD协议。
* 可灵活配置端口速率。在交换式局域网中，由于端口独占带宽，每个端口可根据情况配置不同的端口速率，或自适应端口速率。
* 可扩充性和网络延展性好。大容量交换机可方便建立一个大规模的局域网，如校园网、企业网。
* 易于管理，便与调整网络负载的分布，有效的利用网络带宽。如构造虚拟局域网（VLAN），控制端口流量，过滤MAC地址等。
* 可以和相同协议的共享式以太网兼容。

事实上，现在家中常用的无线路由器集成了二层交换机的功能，具备以上所说的所有功能，家庭局域网也就是交换式以太网。

#### 2.3.3 高速以太网
高速以太网即最高传输速率大于等于100Mbps的以太网。

##### 1.快速以太网
快速以太网即传输速率为100Mbps的以太网，保留传统以太网的所有特征，标准代号为IEEE 802.3u。该标准定义了多种传输介质：
* 100BASE-T4：支持4对3类非屏蔽双绞线，3对用于传输1对冲突检测，半双工。
* 100BASE-TX：支持2对5类非屏蔽双绞线或2对1类屏蔽双绞线，1对用于发送，一对用于接收。这是一个全双工系统，每个节点可以同时以100Mbps的速率发送或接受数据，最大传输数据100m。
* 100BASE-FX：支持2芯多模光纤，1芯用于发送1芯用于接收，是全双工系统，传输距离达2km。

其中后两者应用广泛。
##### 2.千兆以太网
标准：IEEE 802.3z IEEE 802.3ab，前者使用多模光纤和屏蔽双绞线，后者使用单模光纤和非屏蔽双绞线。主要传输介质：
* 1000BASE-SX：SX表示短波长，只支持多模光纤。
* 1000BASE-LX:LX表示长波长，及支持单模光纤也支持多模光纤。
* 1000BASE-CX:CX表示铜线，使用2对屏蔽双绞线，最大传输距离为25m。
* 1000BASE-T：使用4对超5类非屏蔽双绞线，最大传送距离为100m。但超5类线实际有效距离很难达到100m，最好使用6类线。

##### 3.万兆以太网
标准：IEEE 802.3ae 

万兆以太网只使用光纤，而且只在全双工方式下工作，因此不需要CSMA/CD协议。万兆以太网不仅仅将速率提升，其目标在于扩展以太网，使其能超越LAN,进入WAN和MAN，因此IEEE为万兆以太网指定两个分离的物理层标准，一个是为LAN设计，一个是为WAN设计：
* 局域网物理层LAN PHY：恰好提供10Gbps，千兆以太网的更快版本，主要差异是10Gbps万兆以太网不支持半双工，其网络范围最大可到40km。
* 可选的WAN PHY：与LAN有较大差别，采用9.58464Gbps速率。使用单模光纤时传输距离可达300km，多模光纤也达到40km。

##### 4.10/100Mbps或10/100/1000Mbps自适应以太网
能根据端口和设备自动选择硬件能够达到的最高速率，也可通过人工选择速率，非常灵活。目前自适应端口只用于连接双绞线的RJ-45端口，而不用于光纤端口。

#### 2.4 虚拟局域网（VLAN）
类型：根据VLAN的成员不同，分为基于端口的VLAN和基于策略的VLAN。

标准：IEEE 802.3ac

建立在交换式局域网的基础上，采取软件方式构建的可跨域不同物理网段的一种逻辑网络。位于同一个物理位置的多个节点可以分属不同的逻辑工作组，位于不同物理位置的节点也可以属于同一个逻辑工作组，只要他们各自所连接的交换机支持VLAN功能并且是互联的；当节点改变其工作组时，只需要通过交换机上的软件进行设定，而不需要改变它们的物理位置。VLAN可以有效地隔离广播，将广播数据报限制在同一个VLAN内，从而有效提高了网络整体的有效带宽。
##### 2.4.1 VLAN的类型
根据VLAN成员的定义方式不同，VLAN通常分为两大类：基于端口的VLAN和基于策略的VLAN，后者又分三种情况：基于MAC地址，基于协议和基于源IP子网。在以IP应用为主的大型局域网中，应用较多为基于端口的VLAN和基于IP子网的VLAN。
* 基于端口的VLAN：按照端口配置，创建时先分配一个VID，再指定属于该VLAN的交换机端口。这种VLAN和上层协议无关，可以配置在三层交换机，也可以配置在二层交换机。

* 基于策略的VLAN：端口为动态加入，分为永久成员，非成员，潜在成员。对于潜在成员，交换机监视端口流量，一旦发现于策略匹配则将其加入VLAN，而当没有匹配的流量流过且过时后，则从VLAN中删除该端口。由于交换机仅监视潜在端口，故服务端需设置为永久成员，因为服务器很少发出请求，若设置为潜在成员，过时后就不能被客户端访问。
  * 基于源MAC地址的VLAN：通过网卡的MAC地址决定其隶属的VLAN子网，一个VLAN成员是事先设定好的MAC地址列表。不足在于，获取MAC地址和配置交换机过程繁杂，不适合大型节点网络。
  * 基于源IP子网和基于协议的VLAN：根据IP子网地址或网络协议的不同来划分VLAN。例如可以定义一个IP子网网段为一个VLAN，所有属于这个子网的IP 的流量的端口都被动态加入VLAN（通过子网掩码识别，比MAC地址列表中查找高效很多）；也可以定义一个使用IPX协议的VLAN，则所有具有这种IPX协议流量的端口都被动态加入VLAN。 

  基于源iP子网和基于协议的VLAN只能实现与第三层交换机，当VLAN跨越第二层和第三层交换机配置时，只能配置基于端口的VLAN。
### **2.5 无线局域网（WLAN）**
#### 2.5.1 WLAN的种类
红外线无线局域网、扩频无线局域网（最普遍使用的、IEEE 802.11标准的无线局域网）、窄带微波无线局域网
#### 2.5.2 IEEE 802.11 系列标准
* IEEE 802.11b：工作于2.4GHz，最大传输速率11Mbps
* IEEE 802.11a：工作于5GHz，最大传输速率54Mbps
* IEEE 802.11g：混合标准，既可以在2.4GHz提供11Mbps的传输速率，也可以在5GHz提供54Mbps的传输速率，且兼容IEEE 802.11a。
* IEEE 802.11e增强了MAC层。IEEE 802.11f定义了称为IAPP的协议，实现不同供应商接入点之间的互操作性。IEEE 802.11i是对802.11 MAC层在安全性方面的增强。
* 无线局域网的发展趋势：向更高速率、更高频带发展，积极研究无线局域网与3G、4G蜂窝移动通信的互通与融合。

#### 2.5.3 WLAN 的介质访问特点
由于无线局域网的传输无线用户共享传输信道，且电磁波呈扩散式传播，在WLAN的MAC层，802.11、802.11b、802.11a、802.11g四种标准均采用CSMA/CA协议，但与传统以太网种CSMA/CD协议不同，采用发送前先对信道进行预约以避免冲突。
#### 2.5.4 WLAN 的两种组织模式
##### 1. 有固定基础设施的WLAN
预先建立起来的、能够覆盖一定地理范围的一批固定基站。

由基本服务集BSS构成，一个基本服务集BSS包括一个**基站**和若干个**移动站**，所有移动站在本BSS内都可以直接通信。一个基本服务集覆盖的地理范围叫基本服务区，一般可以有几十米到几百米。

基本服务集里的基站叫做接入点AP（可以想象为无线路由器），作用和网桥类似。一个基本服务集可以使孤立的（无线路由器未接入WAN，仅仅创建了LAN），也可以通过接入点AP连接到一个主干分配系统DS，然后再接入到另一个基本服务集。这样就够成了一个扩展服务集ESS，分配系统使ESS对上层的表现像一个BSS一样。分配系统可以使用以太网，还可以为无线用户提供到有线网络的接入，甚至连接到Internet。

一个移动站（终端设备）若要加入一个BSS，就必须先选择一个AP，于此AP建立关联。方法有两种：被动扫描和主动扫描（在常见设备连接WLAN的设置中有体现）。被动扫描：等待AP发出周期性信标帧；主动扫描：发出探测请求帧，然后等待回应探测响应帧。

##### 2. 无固定基础设施的WLAN
由处于平等状态的移动站之间相互通信组成临时网络（移动热点属于这一方式，类似的还有打印机、相机上的Wi-Fi传输）。一般不和外界Internet网络相连。

#### 2.5.5 无线局域网硬件

##### 1. 无线网卡
作用类似于以太网中的网卡，作为WLAN的接口，实现与WLAN的连接。根据接口类型，分为PCMCIA无线网卡、PCI无线网卡和USB无线网卡。第一种仅用于laptop，支持热插拔，第二种用于普通PC，第三种常用于外置网卡。

##### 2. 无线接入点
将多个无线用户互联起来组成一个无线局域网，然后使用RJ-45接口接入以太网，使无线局域网与有限局域网桥接。由于无线局域网共享介质和带宽，使得用户越多，每个用户的带宽就很有限，所有要合理安排接入点的位置和数量。
![无线接入点](https://blog.yarnoma.com/wp-content/uploads/2018/12/图2.21无线接入点AP的典型应用_1.jpg)
##### 3. 无线网桥
在链路层实现互联的存储转发设备，连接距离较远的两个或多个网络，使用点对点连接或点对多点连接。

##### 4. 无线宽带路由器
即常见的家用无线路由器。


### **2.6 广域网技术**
主要的用来实现远程通信的公共通信服务网友：公共交换电话网（PSTN）、数字数据网（DDN）、分组交换数据网（X.25）、帧中继网（FR）、综合业务数字网（ISDN）。

## **第3章 网络互连与TCP/IP协议**

### **3.1 网络互连问题**
两个网络只要有一层的协议不同，就叫做**异构网络**，早起异构网络在应用层互连，事实证明很不可靠。后来发现，解决网络互连最好的方法是上层采用相同的协议（即网络层的TCP/IP协议、TCP/UDP协议以及HTTP/FTP等应用层协议），允许不同的机构使用不同的下层技术（如数据链路层使用以太网、无线局域网等），同时相同的上层协议将下层协议的异质性屏蔽起来，网络就像一张统一的大网。这种协议就是TCP/IP协议，其基本思想是任何一个传递分组的网络，都可以作为一个物理子网连入到网络中，在网络层采用统一的IP协议，使得屏蔽底层网络的细节，当硬件条件发生改变时，不需要修改应用程序。

### **3.2 IP地址**

#### 3.2.1 IP地址及其结构
##### 1. IP地址及其表示
IP地址由32位二进制数组成，为方便人理解，采用一种”点分十进制“的表示方法，每一个字节对应一个整数。
##### 2. IP地址的结构
分为网络号和主机号，网络号表示互联网上的某个网络；主机号表示该网络上的某台主机。

#### 3.2.2 IP地址的分类
![IP地址的分类](https://blog.yarnoma.com/wp-content/uploads/2018/12/ip地址分类_1.jpg)
##### 1. A类地址
* 第一位为0，第2-8位为网络号，后面为主机号。
* 因此，A类IP地址可以表示第一字节为的$1 \sim 126$的地址，总共有$2^7-2 = 126$个网络（除去0和127开头的保留IP地址），而每个网络中有$2^{24}-2$个主机（除去全0和全1的保留IP地址）。
* 这些IP地址具有的特征是一个网络数少，一个网络内可以容纳的主机数很多，适合大量主机的网络用户，例如苹果、微软。
##### 2. B类地址
* 第一字节的前两位为1和0，第3-16位为网络号，后面为主机号，即前两个字节是网络号，后面是主机号。
* 因此，B类IP地址可以表示第一字节是$128 \sim 191$的地址（但第二字节也表示网络号），总共有$2^{14} = 16384$个网络，每个网络内有$2^{16}-2$=65534台主机（去掉全0和1）。
* B类IP地址一般分配给中等规模网络的用户，一些规模比较大的大学一般拥有B类地址，如清华大学的网络号第一段为166。

##### 3. C类地址
* 第一个字节的前三位分别为1，1，0，第4-24位为网络号，后面为主机号。
* 因此，C类IP地址可以表示第一字节为$192 \sim 223$的地址（但第二、三字节也表示网络号），总共有$2^{21}=2097152$个网络，每个网络内有$2^{8} -2= 254$个主机（去掉全0和1）。
* C类IP地址一般分配给小型规模的局域网用户，我国高校校园网大多数为C类地址。

#### 3.2.3 特殊IP地址
TCP/IP对IP地址的网络号和主机号有如下规定：
* 网络编号必须唯一
* 网络编号不能以127开头，A类127是一个保留地址，用于本地计算机通信，叫做回环地址，127.0.0.1即本地计算机地址localhost，向该地址发送的分组将立即返回本机。
* 第一字节不能都设置为1（255），此数字留做广播地址使用；也不能都设置为0，表示“本网络”。
* 对每个网络号来说，主机编号必须唯一
* 主机编号各个位不能都设置为1（全255），全为1的编号作为广播使用，即向同一IP网络内所有主机发送广播数据包。
* 主机编号也都不能设置为0，全0没有特定的用途，永远不会出现在IP地址中。
  
#### 3.2.4 IP地址的管理
ICANN，用户向低级ISP申请IP地址，低级ISP向高级ISP申请，顶级ISP直接向ICANN申请。

#### 3.2.5 保留的IP地址
![保留IP地址](https://blog.yarnoma.com/wp-content/uploads/2018/12/表3.3为专用网络保留的IP地址块_1.jpg)
* 10.x.x.x、172.16.x.x、192.168.x.x网段的IP地址是为局域网保留的IP地址，这些IP地址不能在Internet上被访问，只能在内网被访问。这些IP地址要访问Internet需要通过网络地址转换（NAT）转换成非保留的公网IP进行Internet访问。
* 169.254.x.x网段的IP地址是为局域网自动分配的IP地址，当一个局域网建立后但没有DHCP动态分配IP地址后，会分配这样网段的IP地址供内网访问，这样的地址不能配置默认网关，不能访问Internet。

### **3.3 IP编址的扩展**
两种需求：
* 小规模网络需要和其他物理网络共享一个IP地址避免浪费（划分子网）
* 较大规模的网络需要分配多个IP地址以满足需求（无类型编址）

#### 3.3.1 子网编址
使得多个物理网络可以共用一个相同的IP网络地址，也就是说，把一部分主机号划分为网络号，但是这里的网络号是人为划分的，叫做子网号。

划分后要想识别一个地址是不是与自己IP地址属于同一个子网地址，就需要**子网掩码**。子网掩码也是和IP地址相同位数的一个二进制数，它是通过IP地址的网络号、子网号、主机号来确定的。子网掩码中，一个IP地址的网络号和子网号对应的位数是1，主机号对应的位数是0。例如将192.168.0.0划分子网，子网掩码为255.255.255.0，第一个字节和第二个字节是网络号不变，第三个字节是子网号，第四个字节是主机号。显然第三个字节划分了255个子网，第四个字节使得每个网络中有254个主机。

例如，192.168.1.1 255.255.255.0和192.168.2.2 255.255.255.0两个IP地址。第一个IP地址可以认为是一个默认网关，第二个IP地址是另一个物理网络内的主机。假如默认网关收到网络内要发送目标为192.168.2.2 255.255.255.0的数据，它要判断这个地址是否在这个物理网络内（以决定是在进行第二层转发还是进行路由转发），就把目的地址的子网掩码分别和自己的IP地址与目的IP地址做位于运算，得到的结果分别是192.168.1.0和192.168.2.0（为了方便写为点分十进制），这两个值不同，就说明这个地址不和网关在同一物理网络内，就要进行路由转发。

#### 3.3.2 无类型编址（CIDR）
就是采用和子网掩码类似的方式，在IP地址后加一个斜线和数字，数字表示网络号的位数。比如，192.168.1.1/24，和192.168.1.1 255.255.255.0表示的意义相同。

